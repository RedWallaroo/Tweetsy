<html>
 <head>
   <script src="../static/d3.v3.min.js"></script>
   <script src="../static/underscore-min.js"></script>
   <script src="../static/backbone-min.js"></script>
   <link rel="stylesheet" type="text/css" href="../static/style.css"> 
  </head>
 <body class = "body">
  <div id ="main_logo" class = "main_logo">
    <img class = "logo" src="../static/tweetsy_logo_v7.png">
  </div>
  <div id="group1" class = "group1">
  <div id="maincontainer" class = "main_container">
  <div id="container1" class = "canvas"></div></div></div>
    <!-- Datamaps Source -->
    <script src="../static/datamaps-all.js"></script>
    <script type="text/javascript">

    json_data = {{ data|tojson|safe }}

var Listing_Object = Backbone.Model.extend({
  defaults: {
    id: null,
    title: null,
    views: null,
    favorers: null,
    latitude: null,
    longitude: null,
    yeild: 0,
    radius: 5.0,
    fillKey: 'DOT',
    country: null,
    date: null
  }
});

var Listing_Collection = Backbone.Collection.extend({
  model: Listing_Object,
  initialize: function (models,options){}
});

var Listing_Data = new Listing_Collection(json_data, { view: this })

//prep the data
    var yields = Listing_Data.pluck('yeild');
    var min = d3.min( yields );
    var max = d3.max( yields );

    var scale = d3.scale.pow()
        .domain([min, max])
        .range([10, 45]);

    Listing_Data.each(function(val, idx) {
        Listing_Data.at(idx).set('radius', scale(val.get('yeild')));
    });

   $("#container1").datamap({
        scope: 'world',
        bubbles: Listing_Data.toJSON(),
        bubble_config: {
            popupTemplate: _.template([
                '<div class="hoverinfo"><strong><%= data.title %></strong>',
                '<br/>Views: <%= data.views %>',
                '<br/>Favorers: <%= data.favorers %>',
                '<br/>Listing Id: <%= data.id %>',
                '</div>'].join(''))
        },
        geography_config: {
            popupOnHover: false,
            highlightOnHover: false
        },
        fills: {
            'DOT': '#1f77b4',
            defaultFill: '#969496'
        },
    });

   </script>
   {{ data.listing_id }}
<br style="clear:both" />
   <div id="content">
                 <div id="sub-content">
                 <div id="column1">
                 <h2>About Tweetsy</h2>
                   <p>In a few words, Tweetsy uses the Twitter API to
                    grab a sample of tweets matching the search term 'Etsy'.
                    The search also includes a parameter to only search
                    for tweets with geolocation data.</p>

                    <p>It then filters the sampled data and keeps only tweets 
                    that contain a url linking to an Etsy listing
                    (or product). With this information, it places a call
                    to the Etsy API and grabs the listing's information.</p> 
                    
                    <p>Once all the information has been gathered, it uses
                      the tweet's geolocation data and D3.js to locate the 
                      tweet's source and listing's data on the map above.</p>
                 </div>
                 <div id="column2">
                 <h2>Libraries</h2>
                   <p>Tweetsy uses the following libraries:</p>
                   <li><a href="https://github.com/mbostock/d3"> D3.js </a></li>
                   <li><a href="https://code.google.com/p/geopy/"> geopy </a></li>
                   <li><a href="https://code.google.com/p/python-twitter/"> python-twitter </a></li>
                   <li><a href="https://github.com/mcfunley/etsy-python"> etsy-python </a></li>
                   <li><a href="http://datamaps.github.com/"> Datamaps </a></li>

                 </div>
                  <div id="column3">
                 <h2>Source Code</h2>
                   <p>The source code for Tweetsy can
                   be found on <a href="https://github.com/RedWallaroo/Tweetsy">Github</a></p>

                  <p>If you have any questions, comments, or
                    suggestions for Tweetsy, please contact me
                    via Twitter: @Radwallaroo</p>
                 </div>
               </div>
            </div>

<br style="clear:both" />
 </body>
</html>